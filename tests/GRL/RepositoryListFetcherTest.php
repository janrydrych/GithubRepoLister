<?php
/**
 * This file is part of the GithubRepoLister project
 */

namespace Tests\GRL;

use Github\Api\User;
use Github\Client;
use Github\Exception\InvalidArgumentException;
use Github\ResultPager;
use GRL\RepositoryListFetcher;
use PHPUnit\Framework\TestCase;

/**
 * Tests for RepositoryListFetcher class
 *
 * @author Jan Rydrych <jan.rydrych@gmail.com>
 */
class RepositoryListFetcherTest extends TestCase
{
	/**
	 * @var RepositoryListFetcher
	 */
	private $RLF;

	private function mockClient()
	{
		$userApiMock = $this->createMock(User::class);

		$clientMock = $this->getMockBuilder(Client::class)
		                   ->setMethods(array())
		                   ->getMock();

		$clientMock->method('__call')
		           ->with($this->equalTo('user'))
		           ->willReturn($userApiMock);

		return $clientMock;
	}

	private function mockResultPager($clientMock, String $jsonData)
	{
		$resultPagerMock = $this->getMockBuilder(ResultPager::class)
		                        ->setConstructorArgs(array($clientMock))
		                        ->getMock();

		$resultPagerMock->expects($this->atMost(1))
		                ->method('fetchAll')
		                ->willReturn(json_decode($jsonData, true));

		return $resultPagerMock;
	}

	protected function setUp()
	{
		$testJsonData = '[{"id":105571039,"name":"go-tika","full_name":"google\/go-tika","owner":{"login":"google","id":1342004,"avatar_url":"https:\/\/avatars1.githubusercontent.com\/u\/1342004?v=4","gravatar_id":"","url":"https:\/\/api.github.com\/users\/google","html_url":"https:\/\/github.com\/google","followers_url":"https:\/\/api.github.com\/users\/google\/followers","following_url":"https:\/\/api.github.com\/users\/google\/following{\/other_user}","gists_url":"https:\/\/api.github.com\/users\/google\/gists{\/gist_id}","starred_url":"https:\/\/api.github.com\/users\/google\/starred{\/owner}{\/repo}","subscriptions_url":"https:\/\/api.github.com\/users\/google\/subscriptions","organizations_url":"https:\/\/api.github.com\/users\/google\/orgs","repos_url":"https:\/\/api.github.com\/users\/google\/repos","events_url":"https:\/\/api.github.com\/users\/google\/events{\/privacy}","received_events_url":"https:\/\/api.github.com\/users\/google\/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https:\/\/github.com\/google\/go-tika","description":"Go package for using Apache Tika","fork":false,"url":"https:\/\/api.github.com\/repos\/google\/go-tika","forks_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/forks","keys_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/keys{\/key_id}","collaborators_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/collaborators{\/collaborator}","teams_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/teams","hooks_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/hooks","issue_events_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/issues\/events{\/number}","events_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/events","assignees_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/assignees{\/user}","branches_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/branches{\/branch}","tags_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/tags","blobs_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/git\/blobs{\/sha}","git_tags_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/git\/tags{\/sha}","git_refs_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/git\/refs{\/sha}","trees_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/git\/trees{\/sha}","statuses_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/statuses\/{sha}","languages_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/languages","stargazers_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/stargazers","contributors_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/contributors","subscribers_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/subscribers","subscription_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/subscription","commits_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/commits{\/sha}","git_commits_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/git\/commits{\/sha}","comments_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/comments{\/number}","issue_comment_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/issues\/comments{\/number}","contents_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/contents\/{+path}","compare_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/compare\/{base}...{head}","merges_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/merges","archive_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/{archive_format}{\/ref}","downloads_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/downloads","issues_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/issues{\/number}","pulls_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/pulls{\/number}","milestones_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/milestones{\/number}","notifications_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/notifications{?since,all,participating}","labels_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/labels{\/name}","releases_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/releases{\/id}","deployments_url":"https:\/\/api.github.com\/repos\/google\/go-tika\/deployments","created_at":"2017-10-02T18:43:16Z","updated_at":"2017-10-02T19:55:40Z","pushed_at":"2017-10-02T19:56:40Z","git_url":"git:\/\/github.com\/google\/go-tika.git","ssh_url":"git@github.com:google\/go-tika.git","clone_url":"https:\/\/github.com\/google\/go-tika.git","svn_url":"https:\/\/github.com\/google\/go-tika","homepage":"","size":0,"stargazers_count":1,"watchers_count":1,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":1,"default_branch":"master","permissions":{"admin":false,"push":false,"pull":true}},{"id":105566333,"name":"oboe","full_name":"google\/oboe","owner":{"login":"google","id":1342004,"avatar_url":"https:\/\/avatars1.githubusercontent.com\/u\/1342004?v=4","gravatar_id":"","url":"https:\/\/api.github.com\/users\/google","html_url":"https:\/\/github.com\/google","followers_url":"https:\/\/api.github.com\/users\/google\/followers","following_url":"https:\/\/api.github.com\/users\/google\/following{\/other_user}","gists_url":"https:\/\/api.github.com\/users\/google\/gists{\/gist_id}","starred_url":"https:\/\/api.github.com\/users\/google\/starred{\/owner}{\/repo}","subscriptions_url":"https:\/\/api.github.com\/users\/google\/subscriptions","organizations_url":"https:\/\/api.github.com\/users\/google\/orgs","repos_url":"https:\/\/api.github.com\/users\/google\/repos","events_url":"https:\/\/api.github.com\/users\/google\/events{\/privacy}","received_events_url":"https:\/\/api.github.com\/users\/google\/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https:\/\/github.com\/google\/oboe","description":null,"fork":false,"url":"https:\/\/api.github.com\/repos\/google\/oboe","forks_url":"https:\/\/api.github.com\/repos\/google\/oboe\/forks","keys_url":"https:\/\/api.github.com\/repos\/google\/oboe\/keys{\/key_id}","collaborators_url":"https:\/\/api.github.com\/repos\/google\/oboe\/collaborators{\/collaborator}","teams_url":"https:\/\/api.github.com\/repos\/google\/oboe\/teams","hooks_url":"https:\/\/api.github.com\/repos\/google\/oboe\/hooks","issue_events_url":"https:\/\/api.github.com\/repos\/google\/oboe\/issues\/events{\/number}","events_url":"https:\/\/api.github.com\/repos\/google\/oboe\/events","assignees_url":"https:\/\/api.github.com\/repos\/google\/oboe\/assignees{\/user}","branches_url":"https:\/\/api.github.com\/repos\/google\/oboe\/branches{\/branch}","tags_url":"https:\/\/api.github.com\/repos\/google\/oboe\/tags","blobs_url":"https:\/\/api.github.com\/repos\/google\/oboe\/git\/blobs{\/sha}","git_tags_url":"https:\/\/api.github.com\/repos\/google\/oboe\/git\/tags{\/sha}","git_refs_url":"https:\/\/api.github.com\/repos\/google\/oboe\/git\/refs{\/sha}","trees_url":"https:\/\/api.github.com\/repos\/google\/oboe\/git\/trees{\/sha}","statuses_url":"https:\/\/api.github.com\/repos\/google\/oboe\/statuses\/{sha}","languages_url":"https:\/\/api.github.com\/repos\/google\/oboe\/languages","stargazers_url":"https:\/\/api.github.com\/repos\/google\/oboe\/stargazers","contributors_url":"https:\/\/api.github.com\/repos\/google\/oboe\/contributors","subscribers_url":"https:\/\/api.github.com\/repos\/google\/oboe\/subscribers","subscription_url":"https:\/\/api.github.com\/repos\/google\/oboe\/subscription","commits_url":"https:\/\/api.github.com\/repos\/google\/oboe\/commits{\/sha}","git_commits_url":"https:\/\/api.github.com\/repos\/google\/oboe\/git\/commits{\/sha}","comments_url":"https:\/\/api.github.com\/repos\/google\/oboe\/comments{\/number}","issue_comment_url":"https:\/\/api.github.com\/repos\/google\/oboe\/issues\/comments{\/number}","contents_url":"https:\/\/api.github.com\/repos\/google\/oboe\/contents\/{+path}","compare_url":"https:\/\/api.github.com\/repos\/google\/oboe\/compare\/{base}...{head}","merges_url":"https:\/\/api.github.com\/repos\/google\/oboe\/merges","archive_url":"https:\/\/api.github.com\/repos\/google\/oboe\/{archive_format}{\/ref}","downloads_url":"https:\/\/api.github.com\/repos\/google\/oboe\/downloads","issues_url":"https:\/\/api.github.com\/repos\/google\/oboe\/issues{\/number}","pulls_url":"https:\/\/api.github.com\/repos\/google\/oboe\/pulls{\/number}","milestones_url":"https:\/\/api.github.com\/repos\/google\/oboe\/milestones{\/number}","notifications_url":"https:\/\/api.github.com\/repos\/google\/oboe\/notifications{?since,all,participating}","labels_url":"https:\/\/api.github.com\/repos\/google\/oboe\/labels{\/name}","releases_url":"https:\/\/api.github.com\/repos\/google\/oboe\/releases{\/id}","deployments_url":"https:\/\/api.github.com\/repos\/google\/oboe\/deployments","created_at":"2017-10-02T17:56:48Z","updated_at":"2017-10-02T18:01:19Z","pushed_at":"2017-10-02T17:56:49Z","git_url":"git:\/\/github.com\/google\/oboe.git","ssh_url":"git@github.com:google\/oboe.git","clone_url":"https:\/\/github.com\/google\/oboe.git","svn_url":"https:\/\/github.com\/google\/oboe","homepage":null,"size":0,"stargazers_count":2,"watchers_count":2,"language":null,"has_issues":false,"has_projects":true,"has_downloads":false,"has_wiki":false,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":2,"default_branch":"master","permissions":{"admin":false,"push":false,"pull":true}},{"id":105541516,"name":"skylark","full_name":"google\/skylark","owner":{"login":"google","id":1342004,"avatar_url":"https:\/\/avatars1.githubusercontent.com\/u\/1342004?v=4","gravatar_id":"","url":"https:\/\/api.github.com\/users\/google","html_url":"https:\/\/github.com\/google","followers_url":"https:\/\/api.github.com\/users\/google\/followers","following_url":"https:\/\/api.github.com\/users\/google\/following{\/other_user}","gists_url":"https:\/\/api.github.com\/users\/google\/gists{\/gist_id}","starred_url":"https:\/\/api.github.com\/users\/google\/starred{\/owner}{\/repo}","subscriptions_url":"https:\/\/api.github.com\/users\/google\/subscriptions","organizations_url":"https:\/\/api.github.com\/users\/google\/orgs","repos_url":"https:\/\/api.github.com\/users\/google\/repos","events_url":"https:\/\/api.github.com\/users\/google\/events{\/privacy}","received_events_url":"https:\/\/api.github.com\/users\/google\/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https:\/\/github.com\/google\/skylark","description":"Skylark in Go: the Skylark configuration language, implemented in Go","fork":false,"url":"https:\/\/api.github.com\/repos\/google\/skylark","forks_url":"https:\/\/api.github.com\/repos\/google\/skylark\/forks","keys_url":"https:\/\/api.github.com\/repos\/google\/skylark\/keys{\/key_id}","collaborators_url":"https:\/\/api.github.com\/repos\/google\/skylark\/collaborators{\/collaborator}","teams_url":"https:\/\/api.github.com\/repos\/google\/skylark\/teams","hooks_url":"https:\/\/api.github.com\/repos\/google\/skylark\/hooks","issue_events_url":"https:\/\/api.github.com\/repos\/google\/skylark\/issues\/events{\/number}","events_url":"https:\/\/api.github.com\/repos\/google\/skylark\/events","assignees_url":"https:\/\/api.github.com\/repos\/google\/skylark\/assignees{\/user}","branches_url":"https:\/\/api.github.com\/repos\/google\/skylark\/branches{\/branch}","tags_url":"https:\/\/api.github.com\/repos\/google\/skylark\/tags","blobs_url":"https:\/\/api.github.com\/repos\/google\/skylark\/git\/blobs{\/sha}","git_tags_url":"https:\/\/api.github.com\/repos\/google\/skylark\/git\/tags{\/sha}","git_refs_url":"https:\/\/api.github.com\/repos\/google\/skylark\/git\/refs{\/sha}","trees_url":"https:\/\/api.github.com\/repos\/google\/skylark\/git\/trees{\/sha}","statuses_url":"https:\/\/api.github.com\/repos\/google\/skylark\/statuses\/{sha}","languages_url":"https:\/\/api.github.com\/repos\/google\/skylark\/languages","stargazers_url":"https:\/\/api.github.com\/repos\/google\/skylark\/stargazers","contributors_url":"https:\/\/api.github.com\/repos\/google\/skylark\/contributors","subscribers_url":"https:\/\/api.github.com\/repos\/google\/skylark\/subscribers","subscription_url":"https:\/\/api.github.com\/repos\/google\/skylark\/subscription","commits_url":"https:\/\/api.github.com\/repos\/google\/skylark\/commits{\/sha}","git_commits_url":"https:\/\/api.github.com\/repos\/google\/skylark\/git\/commits{\/sha}","comments_url":"https:\/\/api.github.com\/repos\/google\/skylark\/comments{\/number}","issue_comment_url":"https:\/\/api.github.com\/repos\/google\/skylark\/issues\/comments{\/number}","contents_url":"https:\/\/api.github.com\/repos\/google\/skylark\/contents\/{+path}","compare_url":"https:\/\/api.github.com\/repos\/google\/skylark\/compare\/{base}...{head}","merges_url":"https:\/\/api.github.com\/repos\/google\/skylark\/merges","archive_url":"https:\/\/api.github.com\/repos\/google\/skylark\/{archive_format}{\/ref}","downloads_url":"https:\/\/api.github.com\/repos\/google\/skylark\/downloads","issues_url":"https:\/\/api.github.com\/repos\/google\/skylark\/issues{\/number}","pulls_url":"https:\/\/api.github.com\/repos\/google\/skylark\/pulls{\/number}","milestones_url":"https:\/\/api.github.com\/repos\/google\/skylark\/milestones{\/number}","notifications_url":"https:\/\/api.github.com\/repos\/google\/skylark\/notifications{?since,all,participating}","labels_url":"https:\/\/api.github.com\/repos\/google\/skylark\/labels{\/name}","releases_url":"https:\/\/api.github.com\/repos\/google\/skylark\/releases{\/id}","deployments_url":"https:\/\/api.github.com\/repos\/google\/skylark\/deployments","created_at":"2017-10-02T14:05:01Z","updated_at":"2017-10-02T20:01:46Z","pushed_at":"2017-10-02T18:58:42Z","git_url":"git:\/\/github.com\/google\/skylark.git","ssh_url":"git@github.com:google\/skylark.git","clone_url":"https:\/\/github.com\/google\/skylark.git","svn_url":"https:\/\/github.com\/google\/skylark","homepage":"","size":168,"stargazers_count":14,"watchers_count":14,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":14,"default_branch":"master","permissions":{"admin":false,"push":false,"pull":true}},{"id":105428926,"name":"tmppy","full_name":"google\/tmppy","owner":{"login":"google","id":1342004,"avatar_url":"https:\/\/avatars1.githubusercontent.com\/u\/1342004?v=4","gravatar_id":"","url":"https:\/\/api.github.com\/users\/google","html_url":"https:\/\/github.com\/google","followers_url":"https:\/\/api.github.com\/users\/google\/followers","following_url":"https:\/\/api.github.com\/users\/google\/following{\/other_user}","gists_url":"https:\/\/api.github.com\/users\/google\/gists{\/gist_id}","starred_url":"https:\/\/api.github.com\/users\/google\/starred{\/owner}{\/repo}","subscriptions_url":"https:\/\/api.github.com\/users\/google\/subscriptions","organizations_url":"https:\/\/api.github.com\/users\/google\/orgs","repos_url":"https:\/\/api.github.com\/users\/google\/repos","events_url":"https:\/\/api.github.com\/users\/google\/events{\/privacy}","received_events_url":"https:\/\/api.github.com\/users\/google\/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https:\/\/github.com\/google\/tmppy","description":"TMPPy is a subset of Python that can be compiled to C++ meta-functions using the py2tmp compiler.","fork":false,"url":"https:\/\/api.github.com\/repos\/google\/tmppy","forks_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/forks","keys_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/keys{\/key_id}","collaborators_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/collaborators{\/collaborator}","teams_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/teams","hooks_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/hooks","issue_events_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/issues\/events{\/number}","events_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/events","assignees_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/assignees{\/user}","branches_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/branches{\/branch}","tags_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/tags","blobs_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/git\/blobs{\/sha}","git_tags_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/git\/tags{\/sha}","git_refs_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/git\/refs{\/sha}","trees_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/git\/trees{\/sha}","statuses_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/statuses\/{sha}","languages_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/languages","stargazers_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/stargazers","contributors_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/contributors","subscribers_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/subscribers","subscription_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/subscription","commits_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/commits{\/sha}","git_commits_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/git\/commits{\/sha}","comments_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/comments{\/number}","issue_comment_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/issues\/comments{\/number}","contents_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/contents\/{+path}","compare_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/compare\/{base}...{head}","merges_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/merges","archive_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/{archive_format}{\/ref}","downloads_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/downloads","issues_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/issues{\/number}","pulls_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/pulls{\/number}","milestones_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/milestones{\/number}","notifications_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/notifications{?since,all,participating}","labels_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/labels{\/name}","releases_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/releases{\/id}","deployments_url":"https:\/\/api.github.com\/repos\/google\/tmppy\/deployments","created_at":"2017-10-01T08:29:32Z","updated_at":"2017-10-02T01:17:35Z","pushed_at":"2017-10-01T17:51:34Z","git_url":"git:\/\/github.com\/google\/tmppy.git","ssh_url":"git@github.com:google\/tmppy.git","clone_url":"https:\/\/github.com\/google\/tmppy.git","svn_url":"https:\/\/github.com\/google\/tmppy","homepage":"https:\/\/github.com\/google\/tmppy\/wiki","size":131,"stargazers_count":1,"watchers_count":1,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":false,"has_wiki":true,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":45,"forks":0,"open_issues":45,"watchers":1,"default_branch":"master","permissions":{"admin":false,"push":false,"pull":true}},{"id":105286778,"name":"VRD","full_name":"google\/VRD","owner":{"login":"google","id":1342004,"avatar_url":"https:\/\/avatars1.githubusercontent.com\/u\/1342004?v=4","gravatar_id":"","url":"https:\/\/api.github.com\/users\/google","html_url":"https:\/\/github.com\/google","followers_url":"https:\/\/api.github.com\/users\/google\/followers","following_url":"https:\/\/api.github.com\/users\/google\/following{\/other_user}","gists_url":"https:\/\/api.github.com\/users\/google\/gists{\/gist_id}","starred_url":"https:\/\/api.github.com\/users\/google\/starred{\/owner}{\/repo}","subscriptions_url":"https:\/\/api.github.com\/users\/google\/subscriptions","organizations_url":"https:\/\/api.github.com\/users\/google\/orgs","repos_url":"https:\/\/api.github.com\/users\/google\/repos","events_url":"https:\/\/api.github.com\/users\/google\/events{\/privacy}","received_events_url":"https:\/\/api.github.com\/users\/google\/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https:\/\/github.com\/google\/VRD","description":null,"fork":false,"url":"https:\/\/api.github.com\/repos\/google\/VRD","forks_url":"https:\/\/api.github.com\/repos\/google\/VRD\/forks","keys_url":"https:\/\/api.github.com\/repos\/google\/VRD\/keys{\/key_id}","collaborators_url":"https:\/\/api.github.com\/repos\/google\/VRD\/collaborators{\/collaborator}","teams_url":"https:\/\/api.github.com\/repos\/google\/VRD\/teams","hooks_url":"https:\/\/api.github.com\/repos\/google\/VRD\/hooks","issue_events_url":"https:\/\/api.github.com\/repos\/google\/VRD\/issues\/events{\/number}","events_url":"https:\/\/api.github.com\/repos\/google\/VRD\/events","assignees_url":"https:\/\/api.github.com\/repos\/google\/VRD\/assignees{\/user}","branches_url":"https:\/\/api.github.com\/repos\/google\/VRD\/branches{\/branch}","tags_url":"https:\/\/api.github.com\/repos\/google\/VRD\/tags","blobs_url":"https:\/\/api.github.com\/repos\/google\/VRD\/git\/blobs{\/sha}","git_tags_url":"https:\/\/api.github.com\/repos\/google\/VRD\/git\/tags{\/sha}","git_refs_url":"https:\/\/api.github.com\/repos\/google\/VRD\/git\/refs{\/sha}","trees_url":"https:\/\/api.github.com\/repos\/google\/VRD\/git\/trees{\/sha}","statuses_url":"https:\/\/api.github.com\/repos\/google\/VRD\/statuses\/{sha}","languages_url":"https:\/\/api.github.com\/repos\/google\/VRD\/languages","stargazers_url":"https:\/\/api.github.com\/repos\/google\/VRD\/stargazers","contributors_url":"https:\/\/api.github.com\/repos\/google\/VRD\/contributors","subscribers_url":"https:\/\/api.github.com\/repos\/google\/VRD\/subscribers","subscription_url":"https:\/\/api.github.com\/repos\/google\/VRD\/subscription","commits_url":"https:\/\/api.github.com\/repos\/google\/VRD\/commits{\/sha}","git_commits_url":"https:\/\/api.github.com\/repos\/google\/VRD\/git\/commits{\/sha}","comments_url":"https:\/\/api.github.com\/repos\/google\/VRD\/comments{\/number}","issue_comment_url":"https:\/\/api.github.com\/repos\/google\/VRD\/issues\/comments{\/number}","contents_url":"https:\/\/api.github.com\/repos\/google\/VRD\/contents\/{+path}","compare_url":"https:\/\/api.github.com\/repos\/google\/VRD\/compare\/{base}...{head}","merges_url":"https:\/\/api.github.com\/repos\/google\/VRD\/merges","archive_url":"https:\/\/api.github.com\/repos\/google\/VRD\/{archive_format}{\/ref}","downloads_url":"https:\/\/api.github.com\/repos\/google\/VRD\/downloads","issues_url":"https:\/\/api.github.com\/repos\/google\/VRD\/issues{\/number}","pulls_url":"https:\/\/api.github.com\/repos\/google\/VRD\/pulls{\/number}","milestones_url":"https:\/\/api.github.com\/repos\/google\/VRD\/milestones{\/number}","notifications_url":"https:\/\/api.github.com\/repos\/google\/VRD\/notifications{?since,all,participating}","labels_url":"https:\/\/api.github.com\/repos\/google\/VRD\/labels{\/name}","releases_url":"https:\/\/api.github.com\/repos\/google\/VRD\/releases{\/id}","deployments_url":"https:\/\/api.github.com\/repos\/google\/VRD\/deployments","created_at":"2017-09-29T15:15:29Z","updated_at":"2017-09-29T17:16:45Z","pushed_at":"2017-09-29T15:15:30Z","git_url":"git:\/\/github.com\/google\/VRD.git","ssh_url":"git@github.com:google\/VRD.git","clone_url":"https:\/\/github.com\/google\/VRD.git","svn_url":"https:\/\/github.com\/google\/VRD","homepage":null,"size":0,"stargazers_count":3,"watchers_count":3,"language":null,"has_issues":false,"has_projects":true,"has_downloads":false,"has_wiki":false,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":3,"default_branch":"master","permissions":{"admin":false,"push":false,"pull":true}}]';

		$clientMock = $this->mockClient();
		$resultPagerMock = $this->mockResultPager($clientMock, $testJsonData);

		$this->RLF = new RepositoryListFetcher($clientMock, $resultPagerMock);

		parent::setUp();
	}

	protected function tearDown()
	{
		unset($this->RLF);

		parent::tearDown();
	}

	public function testGetRepositoriesDataWithNullCredentials()
	{
		$result = $this->RLF->getRepositoriesData(null, null);
		$this->assertSame(array(false, 'Invalid Credentials'),
		                  $result,
		                  '->getRepositoriesData() must return false response for invalid credentials');
	}

	public function testGetRepositoriesDataWithCredentialsSet()
	{
		$result = $this->RLF->getRepositoriesData('username', 'password');
		$this->assertInternalType('array', $result, '->getRepositoriesData() must return array type');
		$this->assertTrue($result[0], '->getRepositoriesData() must return true response');
		$this->assertCount(5, $result[1], '->getRepositoriesData() must return nonempty result');
		$this->assertArrayHasKey('full_name',
		                         $result[1][0],
		                         '->getRepositoriesData() must return all desired key fields result');
	}

	public function testGetRepositoriesDataWithDesiredRepositoryFieldsFiltered()
	{
		$desiredRepositoryFields = array('id');
		$result                  = $this->RLF->getRepositoriesData('username', 'password', $desiredRepositoryFields);
		$this->assertInternalType('array', $result, '->getRepositoriesData() must return array type');
		$this->assertTrue($result[0], '->getRepositoriesData() must return true response');
		$this->assertCount(5, $result[1], '->getRepositoriesData() must return nonempty result');
		$this->assertArrayHasKey('id',
		                         $result[1][0],
		                         '->getRepositoriesData() must return all desired key fields result');
		$this->assertArrayNotHasKey('full_name',
		                            $result[1][0],
		                            '->getRepositoriesData() must return only desired key fields result');
	}

	public function testGetRepositoriesDataWithAuthenticateException()
	{
		$clientMock = $this->mockClient();
		$clientMock->method('authenticate')
		           ->willThrowException(new InvalidArgumentException('You need to specify authentication method!'));
		$resultPagerMock = $this->mockResultPager($clientMock, '');
		$RLF             = new RepositoryListFetcher($clientMock, $resultPagerMock);

		$result = $RLF->getRepositoriesData('username', 'password');
		$this->assertFalse($result[0],
		                   '->getRepositoriesData() must return false response for GithubClient->authenticate() exception');
	}
}
